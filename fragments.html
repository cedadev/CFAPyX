
<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cfapyx Terminology &mdash; CFAPyX Package 2024.10.11 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/CFAPyX.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=24c5af4a"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="cfapyx Usage and Options" href="options.html" />
    <link rel="prev" title="The CFA-Xarray Engine" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CFAPyX Package
              <img src="_static/CFAPyX_long.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Details:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="inspiration.html">Inspiration for CFA</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Xarray Engine Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fragments, Partitions and Chunks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fragments-chunks-and-partitions">Fragments, Chunks and Partitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terms-in-cfapyx">Terms in cfapyx</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="options.html">cfapyx Usage and Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="creator_use.html">CFA Creator Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="creator.html">CFA Creator</a></li>
<li class="toctree-l1"><a class="reference internal" href="backend.html">CFA Backend Entrypoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore.html">CFA DataStore</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrapper.html">CFA Wrappers</a></li>
<li class="toctree-l1"><a class="reference internal" href="groups.html">CFA Groups</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CFAPyX Package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">cfapyx Terminology</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/fragments.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cfapyx-terminology">
<h1>cfapyx Terminology<a class="headerlink" href="#cfapyx-terminology" title="Permalink to this heading"></a></h1>
<p>Provided here is a list of the terminology used throughout <code class="docutils literal notranslate"><span class="pre">cfapyx</span></code> and the equivalents in the CF conventions. In general most terms
within the CF conventions for ‘Aggregated variables’ are preserved within this package, with only some additional terms required.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The page ‘cfapyx Usage and Options’ covers keyword arguments to provide to <code class="docutils literal notranslate"><span class="pre">xarray.open_dataset</span></code> when using the <code class="docutils literal notranslate"><span class="pre">CFA</span></code> engine.
This page is specifically for the terms and conventions used within the package, and will enable developers to understand the meaning of
terms across multiple functions and classes.</p>
</div>
<section id="fragments-chunks-and-partitions">
<span id="id1"></span><h2>Fragments, Chunks and Partitions<a class="headerlink" href="#fragments-chunks-and-partitions" title="Permalink to this heading"></a></h2>
<p>cfapyx has three specific terms for dealing with portions of arrays in different contexts. Directly from the CF conventions, a <code class="docutils literal notranslate"><span class="pre">Fragment</span> <span class="pre">File</span></code> is a
source file for an aggregated variable, therefore the term <code class="docutils literal notranslate"><span class="pre">Fragment</span></code> is in relation to an array from one of these source files which constitutes part
of an aggregation.</p>
<p><code class="docutils literal notranslate"><span class="pre">Chunks</span></code> is in reference to the <code class="docutils literal notranslate"><span class="pre">Dask</span> <span class="pre">Computer</span> <span class="pre">Chunks</span></code> provided by the user with the <code class="docutils literal notranslate"><span class="pre">chunks={}</span></code> argument. If there are no chunks specified,
the Dask array defined with the <code class="docutils literal notranslate"><span class="pre">Fragments</span></code> as individual objects will simply use each <code class="docutils literal notranslate"><span class="pre">Fragment</span></code> as a <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>, so these terms are equivalent.
Alternatively if a chunk scheme is given to dask (which in most cases will not match the Fragment scheme), then additional steps must be taken to
optimise the retrieval of data.</p>
<img alt="Fragments, Chunks and Partitions example." src="_images/FragmentChunkPartition.png" />
<p>The above figure shows a case where a Chunk scheme is provided, as well as the underlying Fragment structure. The convention within this package is to
refer to any array section as a <code class="docutils literal notranslate"><span class="pre">Partition</span></code>. Both <code class="docutils literal notranslate"><span class="pre">Fragments</span></code> and <code class="docutils literal notranslate"><span class="pre">Chunks</span></code> are considered to be <code class="docutils literal notranslate"><span class="pre">Partitions</span></code>. A <code class="docutils literal notranslate"><span class="pre">Partition</span></code> can take any shape within the
given <code class="docutils literal notranslate"><span class="pre">space</span></code> (see Terms in cfapyx below). Originally it was thought that the Chunk and Fragment schemes should be allowed to overlap, and a nested Dask array
could be used to handle  the various shapes and positions, but it was later shown to be much simpler to match the provided chunk structure to the existing fragment
structure, so each chunk is composed of exactly one fragment.</p>
<p>In cfapyx, all Fragment/Chunk/Partition objects inherit from a generalised <code class="docutils literal notranslate"><span class="pre">ArrayPartition</span></code> class which defines certain Lazy behaviour. For the case in the
figure above, CFA would create a Dask array from several <code class="docutils literal notranslate"><span class="pre">ChunkWrapper</span></code> objects, corresponding to each (Orange) Dask chunk. These <code class="docutils literal notranslate"><span class="pre">ChunkWrapper</span></code> instances
would each contain a Dask array created from several <code class="docutils literal notranslate"><span class="pre">CFAPartition</span></code> objects that hold some <code class="docutils literal notranslate"><span class="pre">extent</span></code> of a Fragment. This means there will be multiple
low-level objects for each <code class="docutils literal notranslate"><span class="pre">Fragment</span></code> but their extents will not overlap, so all data points will be covered by exactly 1 low-level object and exactly 1
ChunkWrapper (now considered the second level).</p>
</section>
<section id="terms-in-cfapyx">
<h2>Terms in cfapyx<a class="headerlink" href="#terms-in-cfapyx" title="Permalink to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fragment_size_per_dim</span></code> : The non-padded fragment sizes for each dimension (fragmented or otherwise).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fragment</span> <span class="pre">space</span></code> : The coordinate system that refers to individual fragments. Each coordinate i, j, k refers to the number of
fragments in each of the associated dimensions. Non fragmented dimensions should take the value 0 in that dimension for all fragments.
Otherwise the indices (i,j,k…) will range from 0 to the number of fragments in that corresponding dimension minus 1 (since we are starting from zero.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_array_space</span></code> : The space taken by an array in the <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">space</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fragment_space</span></code> : The total shape of the fragment array in <code class="docutils literal notranslate"><span class="pre">fragment</span> <span class="pre">space</span></code>. (Formerly fragment_array_shape)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fragment_position(s)</span></code> : A single or list of tuple values where each value is the index of a fragment in <code class="docutils literal notranslate"><span class="pre">fragment</span> <span class="pre">space</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fragment_shape(s)</span></code>    : A single or list of tuple values where each value is the <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">shape</span></code> of the array fragment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">shape</span></code> : The shape of a real data array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frag_pos/frag_shape</span></code>  : The identifier for an individual fragment position or shape (see above) when iterating across all or some fragments.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nfrags_per_dim</span></code>       : The total number of fragments in each dimension (1 for non-fragmented dimensions.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fragmented_dim_indexes</span></code> : The indexes of dimensions which are fragmented (0,1,2 etc.) in axis <code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">space</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fragment_info</span></code>        : A dictionary of fragment metadata where each key is the coordinates of a fragment in index space and
the value is a dictionary of the attributes specific to that fragment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">constructor_shape</span></code>    : A tuple object representing the full shape of the <code class="docutils literal notranslate"><span class="pre">fragment</span> <span class="pre">array</span> <span class="pre">variables</span></code> where in some cases
(i.e all fragments having the same value) this shape can be used to expand the array into the proper shape. May not be the most
efficient way of implementing this though, could instead use a get_location/address method and provide the <code class="docutils literal notranslate"><span class="pre">frag_pos</span></code> and whole
location/address <code class="docutils literal notranslate"><span class="pre">fragment</span> <span class="pre">array</span> <span class="pre">variable</span></code>.</p></li>
</ul>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="The CFA-Xarray Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="options.html" class="btn btn-neutral float-right" title="cfapyx Usage and Options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Centre of Environmental Data Analysis Developers,Scientific and Technical Facilities Council (STFC),UK Research and Innovation (UKRI). BSD 2-Clause License. All rights reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #0ecc5778;
    }

    .caption-text, .header h1 {
        color: #45c347
    }

    .note {
        background: #BEEF9E
    }
    .admonition-title {
        background: #335145
    }

    .wy-nav-side {
        background: #001711;
    }

  </style>


</body>
</html>